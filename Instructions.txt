# GENERAL
docker network create \
	--driver bridge \
	--subnet 177.77.0.0/24 \
	--gateway 177.77.0.1 \
	--ip-range 177.77.0.2/24 \
	locale


# SQL
docker pull postgres
docker run -d --name postgresql -e POSTGRES_PASSWORD=postgres --network locale postgres

# docker rm postgresql && docker run -d --name postgresql -e POSTGRES_PASSWORD=postgres --network locale postgres


PGPASSWORD=postgres psql -h localhost -p 5432 -U postgres

CREATE TABLE log_table
(
    id_log_table     SERIAL PRIMARY KEY,
    log_uuid         VARCHAR(64),
    log_datetime     TIMESTAMP,
    ip_address       VARCHAR(32),
    http_method      VARCHAR(32),
    uri              VARCHAR(256),
    http_status_code INTEGER
);

INSERT INTO log_table(log_uuid,
                      log_datetime,
                      ip_address,
                      http_method,
                      uri,
                      http_status_code)
VALUES (gen_random_uuid(),
        CURRENT_TIMESTAMP,
        '192.168.1.1',
        'GET',
        '/example',
        200);


# WEB_API
docker build -t webapi -f Dockerfile ./
docker run --name mywebapi --network locale -d webapi

# docker rmi webapi:latest && docker build -t webapi -f Dockerfile ./
# docker stop mywebapi && docker rm mywebapi && docker run --name mywebapi --network locale -v /var/run/docker.sock:/var/run/docker.sock webapi
# docker run --name mywebapi --network locale -p 8000:8000 webapi


# CLIENT
docker build -t cliapi -f Dockerfile_cliapi ./
docker run -e THREADS=1 -e DELAY=300 --name=mycliapi --network locale -v /var/run/docker.sock:/var/run/docker.sock cliapi


# BACKGROUND_PROCEDURE
docker build -t bgproc -f Dockerfile_bgproc ./
docker run --name=mybgproc --network locale bgproc

# docker rm mybgproc && docker run --name=mybgproc --network locale -v /var/run/docker.sock:/var/run/docker.sock bgproc


# USEFUL_COMMANDS
docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' mywebapi
docker stop mywebapi && docker rm mywebapi && docker run --name mywebapi --network locale -d webapi

THREADS=1 DELAY=300 python3 cli_api.py

curl -X POST -H "Content-Type: application/json" -d '{"log": "192.168.1.1 GET /example 200"}' http://localhost:8000/api/data
